# ğŸš€ Spring PetClinic CI/CD í”„ë¡œì íŠ¸ - ì‹œì‘í•˜ê¸°

## ğŸ“Œ í˜„ì¬ ìƒíƒœ

âœ… **ì™„ë£Œëœ ì‘ì—…:**
1. ë¡œì»¬ Docker ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì„±ê³µ
2. AWS Account ID ì—…ë°ì´íŠ¸ (205922933402)
3. GitHub Actions ì›Œí¬í”Œë¡œìš° ì‘ì„±
4. AWS ë¦¬ì†ŒìŠ¤ ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
5. ëª¨ë“  ì„¤ì • íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ

---

## ğŸ¯ ë¹ ë¥¸ ì‹œì‘ (3ë‹¨ê³„)

### 1ë‹¨ê³„: ë¡œì»¬ í…ŒìŠ¤íŠ¸ (ì´ë¯¸ ì™„ë£Œ âœ…)

```bash
# PostgreSQL + ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
docker-compose up -d front

# ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
# http://localhost:8080
```

**ìƒíƒœ:** âœ… ì •ìƒ ì‘ë™ í™•ì¸ë¨
- PostgreSQL: healthy
- Spring PetClinic (Front): healthy
- Health Check: UP

---

### 2ë‹¨ê³„: GitHubì— ì½”ë“œ í‘¸ì‹œ

```bash
# Git ì´ˆê¸°í™” (ì•„ì§ ì•ˆ í–ˆë‹¤ë©´)
git init
git add .
git commit -m "feat: Spring PetClinic with CI/CD setup"

# GitHub Repository ìƒì„± í›„
git remote add origin https://github.com/<username>/spring-petclinic.git
git branch -M main
git push -u origin main
```

**GitHub Secrets ì„¤ì •:**

Repository â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

| Name | Value |
|------|-------|
| `AWS_ACCESS_KEY_ID` | AWS Access Key |
| `AWS_SECRET_ACCESS_KEY` | AWS Secret Access Key |

---

### 3ë‹¨ê³„: AWS ë¦¬ì†ŒìŠ¤ ìƒì„±

```bash
# ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/create-aws-resources.sh
```

**ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤:**
- ECR ë¦¬í¬ì§€í† ë¦¬ 3ê°œ (front, back1, back2)
- ECS í´ëŸ¬ìŠ¤í„° (petclinic-cluster)
- ECS Task Definitions 3ê°œ
- Security Groups
- IAM Roles
- CloudWatch Log Groups

**ìˆ˜ë™ ìƒì„± í•„ìš” (ì„ íƒì‚¬í•­):**
- RDS PostgreSQL (ë°ì´í„°ë² ì´ìŠ¤)
- ALB (Application Load Balancer)
- ECS Services (front-service, back1-service, back2-service)

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
spring-petclinic-main/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml                 â­ GitHub Actions ì›Œí¬í”Œë¡œìš°
â”‚
â”œâ”€â”€ src/                               âœ… Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â””â”€â”€ main/
â”‚       â”œâ”€â”€ java/
â”‚       â””â”€â”€ resources/
â”‚           â”œâ”€â”€ application.properties
â”‚           â””â”€â”€ application-prod.properties  â­ ìš´ì˜ í™˜ê²½ ì„¤ì •
â”‚
â”œâ”€â”€ Dockerfile                         â­ Docker ì´ë¯¸ì§€ ë¹Œë“œ
â”œâ”€â”€ docker-compose.yml                 â­ ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½
â”œâ”€â”€ Jenkinsfile                        â­ Jenkins CI/CD (ëŒ€ì•ˆ)
â”‚
â”œâ”€â”€ ecs-task-definition-front.json    â­ ECS Task ì •ì˜
â”œâ”€â”€ ecs-task-definition-back1.json
â”œâ”€â”€ ecs-task-definition-back2.json
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ check-aws-resources.sh        â­ AWS ë¦¬ì†ŒìŠ¤ í™•ì¸
â”‚   â”œâ”€â”€ create-aws-resources.sh       â­ AWS ë¦¬ì†ŒìŠ¤ ìë™ ìƒì„±
â”‚   â”œâ”€â”€ local-build-test.sh           â­ ë¡œì»¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ aws-deploy.sh                 â­ ìˆ˜ë™ ë°°í¬
â”‚
â”œâ”€â”€ ë°°í¬ê³¼ì •ì„¤ëª….md                     â­ ë©”ì¸ ì œì¶œ ë¬¸ì„œ
â”œâ”€â”€ README-DEVOPS.md                  ğŸ“– ì „ì²´ êµ¬ì¶• ê°€ì´ë“œ
â”œâ”€â”€ GITHUB-ACTIONS-ê°€ì´ë“œ.md           ğŸ“– GitHub Actions ì‚¬ìš©ë²•
â”œâ”€â”€ ê³¼ì œì œì¶œê°€ì´ë“œ.md                   ğŸ“– ì œì¶œ ì²´í¬ë¦¬ìŠ¤íŠ¸
â””â”€â”€ ì‹œì‘í•˜ê¸°.md                        ğŸ“– ì´ ë¬¸ì„œ
```

---

## ğŸ”„ ë°°í¬ ë°©ë²• (2ê°€ì§€)

### ë°©ë²• 1: GitHub Actions (ê¶Œì¥) â­

**ì¥ì :**
- EC2 Jenkins ì„œë²„ ë¶ˆí•„ìš”
- ì„¤ì •ì´ ê°„ë‹¨
- ë¬´ë£Œ (ì›” 2,000ë¶„)

**ì‚¬ìš© ë°©ë²•:**
1. GitHubì— ì½”ë“œ í‘¸ì‹œ
2. AWS Secrets ì„¤ì •
3. AWS ë¦¬ì†ŒìŠ¤ ìƒì„±
4. `main` ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ë©´ ìë™ ë°°í¬!

```bash
git push origin main
# â†’ GitHub Actions ìë™ ì‹¤í–‰
# â†’ ECR ì´ë¯¸ì§€ í‘¸ì‹œ
# â†’ ECS ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸
```

**ëª¨ë‹ˆí„°ë§:**
- GitHub â†’ Actions íƒ­ì—ì„œ ì‹¤í–‰ ìƒíƒœ í™•ì¸

---

### ë°©ë²• 2: Jenkins

**í•„ìš” ì‚¬í•­:**
- EC2 ì¸ìŠ¤í„´ìŠ¤ (Jenkins ì„œë²„)
- Jenkins ì„¤ì¹˜ ë° ì„¤ì •
- GitHub Webhook ì—°ê²°

**ì‚¬ìš© ë°©ë²•:**
1. EC2ì— Jenkins ì„¤ì¹˜
2. Jenkinsfile ê¸°ë°˜ Pipeline ìƒì„±
3. GitHub Webhook ì„¤ì •
4. ì½”ë“œ í‘¸ì‹œ â†’ Jenkins ìë™ ë¹Œë“œ

**ìì„¸í•œ ê°€ì´ë“œ:** README-DEVOPS.md ì°¸ê³ 

---

## ğŸ› ï¸ ì£¼ìš” ëª…ë ¹ì–´

### ë¡œì»¬ ê°œë°œ

```bash
# Gradle ë¹Œë“œ
./gradlew clean bootJar -x test

# Docker Compose ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f front

# ì •ì§€
docker-compose down
```

### AWS ê´€ë¦¬

```bash
# AWS ë¦¬ì†ŒìŠ¤ í™•ì¸
./scripts/check-aws-resources.sh

# AWS ë¦¬ì†ŒìŠ¤ ìƒì„±
./scripts/create-aws-resources.sh

# ìˆ˜ë™ ë°°í¬
./scripts/aws-deploy.sh
```

### Docker ëª…ë ¹ì–´

```bash
# ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t petclinic .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_URL=jdbc:postgresql://postgres:5432/petclinic \
  -e DB_USERNAME=petclinic \
  -e DB_PASSWORD=petclinic \
  petclinic

# ë¡œê·¸ í™•ì¸
docker logs -f <container-id>

# í—¬ìŠ¤ì²´í¬
curl http://localhost:8080/actuator/health
```

---

## ğŸ“Š ë°°í¬ í”Œë¡œìš°

```
ê°œë°œì ë¡œì»¬
   â†“ (ì½”ë“œ ìˆ˜ì •)
Git Push (main ë¸Œëœì¹˜)
   â†“ (ìë™ íŠ¸ë¦¬ê±°)
GitHub Actions / Jenkins
   â†“
â‘  Gradle ë¹Œë“œ (bootJar)
   â†“
â‘¡ Docker ì´ë¯¸ì§€ ë¹Œë“œ
   â†“
â‘¢ ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ
   â”œâ”€ front:latest, front:<BUILD_NUMBER>
   â”œâ”€ back1:latest, back1:<BUILD_NUMBER>
   â””â”€ back2:latest, back2:<BUILD_NUMBER>
   â†“
â‘£ ECS ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸
   â”œâ”€ front-service (ìƒˆ Task ì‹œì‘)
   â”œâ”€ back1-service (ìƒˆ Task ì‹œì‘)
   â””â”€ back2-service (ìƒˆ Task ì‹œì‘)
   â†“
â‘¤ ALB Health Check
   â†“
â‘¥ ê¸°ì¡´ Task ì¢…ë£Œ (Rolling Update)
   â†“
âœ… ë°°í¬ ì™„ë£Œ!

ì‚¬ìš©ì â† ALB â† ECS Tasks â† RDS PostgreSQL
```

---

## ğŸ” ë¬¸ì œ í•´ê²°

### ë¡œì»¬ ë¹Œë“œ ì‹¤íŒ¨

```bash
# Gradle ìºì‹œ ì‚­ì œ
rm -rf ~/.gradle/caches

# ë‹¤ì‹œ ë¹Œë“œ
./gradlew clean build --no-daemon
```

### Docker ë¹Œë“œ ì‹¤íŒ¨

```bash
# Docker ìºì‹œ ì‚­ì œ
docker system prune -a

# ë‹¤ì‹œ ë¹Œë“œ
docker-compose build --no-cache front
```

### AWS ë¦¬ì†ŒìŠ¤ í™•ì¸

```bash
# ECR ë¦¬í¬ì§€í† ë¦¬ í™•ì¸
aws ecr describe-repositories --region ap-northeast-2

# ECS í´ëŸ¬ìŠ¤í„° í™•ì¸
aws ecs list-clusters --region ap-northeast-2

# ECS ì„œë¹„ìŠ¤ í™•ì¸
aws ecs list-services --cluster petclinic-cluster --region ap-northeast-2
```

---

## ğŸ“š ë¬¸ì„œ ê°€ì´ë“œ

| ë¬¸ì„œ | ìš©ë„ | ë…ì |
|------|------|------|
| **ë°°í¬ê³¼ì •ì„¤ëª….md** | ê³¼ì œ ì œì¶œìš© (ë©”ì¸) | êµìˆ˜ë‹˜/í‰ê°€ì |
| **ì‹œì‘í•˜ê¸°.md** | ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ | ë³¸ì¸/íŒ€ì› |
| **README-DEVOPS.md** | ì „ì²´ êµ¬ì¶• ê°€ì´ë“œ | DevOps ì—”ì§€ë‹ˆì–´ |
| **GITHUB-ACTIONS-ê°€ì´ë“œ.md** | GitHub Actions ì‚¬ìš©ë²• | ê°œë°œì |
| **ê³¼ì œì œì¶œê°€ì´ë“œ.md** | ì œì¶œ ì²´í¬ë¦¬ìŠ¤íŠ¸ | ë³¸ì¸ |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¡œì»¬ ê°œë°œ
- [x] Docker ì„¤ì¹˜ í™•ì¸
- [x] Gradle ë¹Œë“œ ì„±ê³µ
- [x] Docker Compose ì‹¤í–‰ ì„±ê³µ
- [x] http://localhost:8080 ì ‘ì† í™•ì¸

### GitHub ì„¤ì •
- [ ] GitHub Repository ìƒì„±
- [ ] ì½”ë“œ í‘¸ì‹œ ì™„ë£Œ
- [ ] GitHub Secrets ì„¤ì • (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
- [ ] .github/workflows/deploy.yml í™•ì¸

### AWS ì„¤ì •
- [ ] AWS CLI ì„¤ì¹˜ ë° ì„¤ì •
- [ ] AWS ê³„ì • ID í™•ì¸ (205922933402)
- [ ] ECR ë¦¬í¬ì§€í† ë¦¬ ìƒì„± (front, back1, back2)
- [ ] ECS í´ëŸ¬ìŠ¤í„° ìƒì„± (petclinic-cluster)
- [ ] IAM Roles ìƒì„± (ecsTaskExecutionRole, ecsTaskRole)
- [ ] Security Groups ì„¤ì •
- [ ] (ì„ íƒ) RDS PostgreSQL ìƒì„±
- [ ] (ì„ íƒ) ALB ìƒì„±
- [ ] (ì„ íƒ) ECS Services ìƒì„±

### ë°°í¬ í…ŒìŠ¤íŠ¸
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
- [ ] ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ ì„±ê³µ
- [ ] ECS Task ì •ìƒ ì‹¤í–‰
- [ ] (ì„ íƒ) ALBë¥¼ í†µí•œ ì ‘ì† í™•ì¸

### ê³¼ì œ ì œì¶œ
- [ ] ë°°í¬ê³¼ì •ì„¤ëª….md íŒŒì¼ëª… ë³€ê²½ (ì´ë¦„_ê³¼ì •ì„¤ëª….md)
- [ ] ëª¨ë“  ì„¤ì • íŒŒì¼ ìµœì¢… í™•ì¸
- [ ] Git ì»¤ë°‹ & í‘¸ì‹œ
- [ ] ì œì¶œ

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### ì§€ê¸ˆ ë‹¹ì¥ (í•„ìˆ˜)
1. **GitHub Repository ìƒì„± ë° ì½”ë“œ í‘¸ì‹œ**
2. **GitHub Secrets ì„¤ì •** (AWS Credentials)
3. **AWS ë¦¬ì†ŒìŠ¤ ìƒì„±** (`./scripts/create-aws-resources.sh`)

### ê³§ í•  ê²ƒ (ê¶Œì¥)
4. **RDS PostgreSQL ìƒì„±** (AWS ì½˜ì†”)
5. **ALB ìƒì„± ë° ì„¤ì •**
6. **ECS Services ìƒì„±**
7. **GitHub Actions ë°°í¬ í…ŒìŠ¤íŠ¸**

### ë‚˜ì¤‘ì— (ì„ íƒ)
8. CloudWatch ì•ŒëŒ ì„¤ì •
9. Jenkins ì„œë²„ êµ¬ì¶• (ëŒ€ì•ˆ)
10. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ê°œì„ 

---

## ğŸ’¡ íŒ

1. **ë¡œì»¬ ë¨¼ì € í…ŒìŠ¤íŠ¸:** í•­ìƒ `docker-compose`ë¡œ ë¡œì»¬ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸
2. **ì‘ì€ ë‹¨ìœ„ë¡œ ë°°í¬:** í•œ ë²ˆì— ëª¨ë“  ê²ƒì„ ë°°í¬í•˜ì§€ ë§ê³ , ë‹¨ê³„ë³„ë¡œ ì§„í–‰
3. **ë¡œê·¸ í™•ì¸:** ë¬¸ì œ ë°œìƒ ì‹œ CloudWatch Logs í™•ì¸
4. **ë¹„ìš© ê´€ë¦¬:** ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ëŠ” ì¦‰ì‹œ ì‚­ì œ
5. **ë¬¸ì„œ ì°¸ê³ :** ë§‰íˆë©´ README-DEVOPS.mdì™€ GITHUB-ACTIONS-ê°€ì´ë“œ.md ì°¸ê³ 

---

## ğŸ“ ë„ì›€ë§

### GitHub Actions ì‹¤í–‰ í™•ì¸
- GitHub Repository â†’ **Actions** íƒ­

### AWS ë¦¬ì†ŒìŠ¤ í™•ì¸
```bash
./scripts/check-aws-resources.sh
```

### ë¡œì»¬ í…ŒìŠ¤íŠ¸
```bash
docker-compose up -d front
curl http://localhost:8080/actuator/health
```

---

**ì‘ì„±ì¼**: 2025ë…„
**í”„ë¡œì íŠ¸**: Spring PetClinic DevOps CI/CD
**ìƒíƒœ**: âœ… ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ, AWS ë°°í¬ ì¤€ë¹„ ì™„ë£Œ
